!function(t) {
  "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define([], t) : ("undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this).XMPP = t();
}(function() {
  function X(e2) {
    var r2;
    return function(t2) {
      return r2 || e2(r2 = { exports: {}, parent: t2 }, r2.exports), r2.exports;
    };
  }
  var q = X(function(t2, e2) {
    var r2;
    r2 = function(t3, e3) {
      function r3() {
      }
      r3.prototype.name = "PLAIN", r3.prototype.clientFirst = true, r3.prototype.response = function(t4) {
        var e4 = "";
        return (e4 += t4.authzid || "") + "\0" + t4.username + "\0" + t4.password;
      }, r3.prototype.challenge = function(t4) {
        return this;
      }, e3.exports = r3;
    }, "object" == typeof e2 && r2(0, t2);
  }), I = X(function(t2, e2) {
    var r2;
    r2 = function(t3, e3) {
      function r3() {
      }
      r3.prototype.name = "ANONYMOUS", r3.prototype.clientFirst = true, r3.prototype.response = function(t4) {
        return t4.trace || "";
      }, r3.prototype.challenge = function(t4) {
      }, e3.exports = r3;
    }, "object" == typeof e2 && r2(0, t2);
  }), F = X(function(t2, e2) {
    var r2;
    r2 = function(t3, e3) {
      function r3() {
        this._mechs = [];
      }
      r3.prototype.use = function(t4, e4) {
        return e4 || (t4 = (e4 = t4).prototype.name), this._mechs.push({ name: t4, mech: e4 }), this;
      }, r3.prototype.create = function(t4) {
        for (var e4 = 0, r4 = this._mechs.length; e4 < r4; e4++) for (var n2 = 0, o2 = t4.length; n2 < o2; n2++) {
          var i2 = this._mechs[e4];
          if (i2.name == t4[n2]) return new i2.mech();
        }
        return null;
      }, e3.exports = r3;
    }, "object" == typeof e2 && r2(0, t2);
  }), t = {};
  (t = function(t2) {
    return t2 && t2.__esModule ? t2 : { default: t2 };
  }).__esModule = true, t.default = t;
  var e = {};
  (e = function(t2, e2) {
    if (null == t2) return {};
    var r2, n2 = {};
    for (r2 in t2) if ({}.hasOwnProperty.call(t2, r2)) {
      if (e2.includes(r2)) continue;
      n2[r2] = t2[r2];
    }
    return n2;
  }).__esModule = true, e.default = e;
  var o = {};
  function z(t2, e2) {
    return (o = z = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function(t3, e3) {
      return t3.__proto__ = e3, t3;
    }).__esModule = true, o.default = o, z(t2, e2);
  }
  (o = z).__esModule = true, o.default = o;
  var r = {};
  (r = function(t2, e2) {
    t2.prototype = Object.create(e2.prototype), t2.prototype.constructor = t2, o(t2, e2);
  }).__esModule = true, r.default = r;
  var n = {};
  function D(t2) {
    return (n = D = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function(t3) {
      return t3.__proto__ || Object.getPrototypeOf(t3);
    }).__esModule = true, n.default = n, D(t2);
  }
  (n = D).__esModule = true, n.default = n;
  var i = {};
  (i = function(e2) {
    try {
      return -1 !== Function.toString.call(e2).indexOf("[native code]");
    } catch (t2) {
      return "function" == typeof e2;
    }
  }).__esModule = true, i.default = i;
  var s = {};
  function B() {
    try {
      var t2 = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function() {
      }));
    } catch (t3) {
    }
    return (s = function() {
      return !!t2;
    }).__esModule = true, (s.default = s)();
  }
  (s = B).__esModule = true, s.default = s;
  var a = {};
  (a = function(t2, e2, r2) {
    var n2;
    return s() ? Reflect.construct.apply(null, arguments) : ((n2 = [null]).push.apply(n2, e2), e2 = new (t2.bind.apply(t2, n2))(), r2 && o(e2, r2.prototype), e2);
  }).__esModule = true, a.default = a;
  var u = {};
  function U(t2) {
    var r2 = "function" == typeof Map ? /* @__PURE__ */ new Map() : void 0;
    return (u = U = function(t3) {
      if (null === t3 || !i(t3)) return t3;
      if ("function" != typeof t3) throw new TypeError("Super expression must either be null or a function");
      if (void 0 !== r2) {
        if (r2.has(t3)) return r2.get(t3);
        r2.set(t3, e2);
      }
      function e2() {
        return a(t3, arguments, n(this).constructor);
      }
      return e2.prototype = Object.create(t3.prototype, { constructor: { value: e2, enumerable: false, writable: true, configurable: true } }), o(e2, t3);
    }).__esModule = true, u.default = u, U(t2);
  }
  (u = U).__esModule = true, u.default = u;
  function W(e2) {
    var r2, t2 = new Promise(function(t3) {
      r2 = setTimeout(t3, e2);
    });
    return t2.timeout = r2, t2;
  }
  var $ = t(r), H = ((e2) => {
    function t2(t3) {
      t3 = e2.call(this, t3) || this;
      return t3.name = "TimeoutError", t3;
    }
    return (0, $.default)(t2, e2), t2;
  })((0, t(u).default)(Error)), c = {}, l = "object" == typeof Reflect ? Reflect : null, K = l && "function" == typeof l.apply ? l.apply : function(t2, e2, r2) {
    return Function.prototype.apply.call(t2, e2, r2);
  };
  var Y = l && "function" == typeof l.ownKeys ? l.ownKeys : Object.getOwnPropertySymbols ? function(t2) {
    return Object.getOwnPropertyNames(t2).concat(Object.getOwnPropertySymbols(t2));
  } : function(t2) {
    return Object.getOwnPropertyNames(t2);
  }, J = Number.isNaN || function(t2) {
    return t2 != t2;
  };
  function f() {
    f.init.call(this);
  }
  (c = f).once = function(a2, u2) {
    return new Promise(function(t2, e2) {
      function r2(t3) {
        a2.removeListener(u2, n2), e2(t3);
      }
      function n2() {
        "function" == typeof a2.removeListener && a2.removeListener("error", r2), t2([].slice.call(arguments));
      }
      var o2, i2, s2;
      nt(a2, u2, n2, { once: true }), "error" !== u2 && (i2 = r2, s2 = { once: true }, "function" == typeof (o2 = a2).on) && nt(o2, "error", i2, s2);
    });
  }, (f.EventEmitter = f).prototype._events = void 0, f.prototype._eventsCount = 0, f.prototype._maxListeners = void 0;
  var G = 10;
  function h(t2) {
    if ("function" != typeof t2) throw new TypeError('The "listener" argument must be of type Function. Received type ' + typeof t2);
  }
  function Q(t2) {
    return void 0 === t2._maxListeners ? f.defaultMaxListeners : t2._maxListeners;
  }
  function V(t2, e2, r2, n2) {
    var o2, i2;
    return h(r2), void 0 === (o2 = t2._events) ? (o2 = t2._events = /* @__PURE__ */ Object.create(null), t2._eventsCount = 0) : (void 0 !== o2.newListener && (t2.emit("newListener", e2, r2.listener || r2), o2 = t2._events), i2 = o2[e2]), void 0 === i2 ? (i2 = o2[e2] = r2, ++t2._eventsCount) : ("function" == typeof i2 ? i2 = o2[e2] = n2 ? [r2, i2] : [i2, r2] : n2 ? i2.unshift(r2) : i2.push(r2), 0 < (o2 = Q(t2)) && i2.length > o2 && !i2.warned && (i2.warned = true, (n2 = new Error("Possible EventEmitter memory leak detected. " + i2.length + " " + String(e2) + " listeners added. Use emitter.setMaxListeners() to increase limit")).name = "MaxListenersExceededWarning", n2.emitter = t2, n2.type = e2, n2.count = i2.length, r2 = n2, console) && console.warn && console.warn(r2)), t2;
  }
  function Z(t2, e2, r2) {
    t2 = { fired: false, wrapFn: void 0, target: t2, type: e2, listener: r2 }, e2 = function() {
      if (!this.fired) return this.target.removeListener(this.type, this.wrapFn), this.fired = true, 0 === arguments.length ? this.listener.call(this.target) : this.listener.apply(this.target, arguments);
    }.bind(t2);
    return e2.listener = r2, t2.wrapFn = e2;
  }
  function tt(t2, e2, r2) {
    t2 = t2._events;
    if (void 0 === t2) return [];
    t2 = t2[e2];
    if (void 0 === t2) return [];
    if ("function" == typeof t2) return r2 ? [t2.listener || t2] : [t2];
    if (r2) {
      for (var n2 = t2, o2 = new Array(n2.length), i2 = 0; i2 < o2.length; ++i2) o2[i2] = n2[i2].listener || n2[i2];
      return o2;
    }
    return rt(t2, t2.length);
  }
  function et(t2) {
    var e2 = this._events;
    if (void 0 !== e2) {
      e2 = e2[t2];
      if ("function" == typeof e2) return 1;
      if (void 0 !== e2) return e2.length;
    }
    return 0;
  }
  function rt(t2, e2) {
    for (var r2 = new Array(e2), n2 = 0; n2 < e2; ++n2) r2[n2] = t2[n2];
    return r2;
  }
  function nt(r2, n2, o2, i2) {
    if ("function" == typeof r2.on) i2.once ? r2.once(n2, o2) : r2.on(n2, o2);
    else {
      if ("function" != typeof r2.addEventListener) throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + typeof r2);
      r2.addEventListener(n2, function t2(e2) {
        i2.once && r2.removeEventListener(n2, t2), o2(e2);
      });
    }
  }
  Object.defineProperty(f, "defaultMaxListeners", { enumerable: true, get: function() {
    return G;
  }, set: function(t2) {
    if ("number" != typeof t2 || t2 < 0 || J(t2)) throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + t2 + ".");
    G = t2;
  } }), f.init = function() {
    void 0 !== this._events && this._events !== Object.getPrototypeOf(this)._events || (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0;
  }, f.prototype.setMaxListeners = function(t2) {
    if ("number" != typeof t2 || t2 < 0 || J(t2)) throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + t2 + ".");
    return this._maxListeners = t2, this;
  }, f.prototype.getMaxListeners = function() {
    return Q(this);
  }, f.prototype.emit = function(t2) {
    for (var e2 = [], r2 = 1; r2 < arguments.length; r2++) e2.push(arguments[r2]);
    var n2 = "error" === t2, o2 = this._events;
    if (void 0 !== o2) n2 = n2 && void 0 === o2.error;
    else if (!n2) return false;
    if (n2) {
      if ((i2 = 0 < e2.length ? e2[0] : i2) instanceof Error) throw i2;
      n2 = new Error("Unhandled error." + (i2 ? " (" + i2.message + ")" : ""));
      throw n2.context = i2, n2;
    }
    var i2 = o2[t2];
    if (void 0 === i2) return false;
    if ("function" == typeof i2) K(i2, this, e2);
    else for (var s2 = i2.length, a2 = rt(i2, s2), r2 = 0; r2 < s2; ++r2) K(a2[r2], this, e2);
    return true;
  }, f.prototype.on = f.prototype.addListener = function(t2, e2) {
    return V(this, t2, e2, false);
  }, f.prototype.prependListener = function(t2, e2) {
    return V(this, t2, e2, true);
  }, f.prototype.once = function(t2, e2) {
    return h(e2), this.on(t2, Z(this, t2, e2)), this;
  }, f.prototype.prependOnceListener = function(t2, e2) {
    return h(e2), this.prependListener(t2, Z(this, t2, e2)), this;
  }, f.prototype.off = f.prototype.removeListener = function(t2, e2) {
    var r2, n2, o2, i2, s2;
    if (h(e2), void 0 !== (n2 = this._events) && void 0 !== (r2 = n2[t2])) {
      if (r2 === e2 || r2.listener === e2) 0 == --this._eventsCount ? this._events = /* @__PURE__ */ Object.create(null) : (delete n2[t2], n2.removeListener && this.emit("removeListener", t2, r2.listener || e2));
      else if ("function" != typeof r2) {
        for (o2 = -1, i2 = r2.length - 1; 0 <= i2; i2--) if (r2[i2] === e2 || r2[i2].listener === e2) {
          s2 = r2[i2].listener, o2 = i2;
          break;
        }
        if (o2 < 0) return this;
        if (0 === o2) r2.shift();
        else {
          for (var a2 = r2, u2 = o2; u2 + 1 < a2.length; u2++) a2[u2] = a2[u2 + 1];
          a2.pop();
        }
        1 === r2.length && (n2[t2] = r2[0]), void 0 !== n2.removeListener && this.emit("removeListener", t2, s2 || e2);
      }
    }
    return this;
  }, f.prototype.removeAllListeners = function(t2) {
    var e2, r2 = this._events;
    if (void 0 !== r2) {
      if (void 0 === r2.removeListener) 0 === arguments.length ? (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0) : void 0 !== r2[t2] && (0 == --this._eventsCount ? this._events = /* @__PURE__ */ Object.create(null) : delete r2[t2]);
      else if (0 === arguments.length) {
        for (var n2, o2 = Object.keys(r2), i2 = 0; i2 < o2.length; ++i2) "removeListener" !== (n2 = o2[i2]) && this.removeAllListeners(n2);
        this.removeAllListeners("removeListener"), this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0;
      } else if ("function" == typeof (e2 = r2[t2])) this.removeListener(t2, e2);
      else if (void 0 !== e2) for (i2 = e2.length - 1; 0 <= i2; i2--) this.removeListener(t2, e2[i2]);
    }
    return this;
  }, f.prototype.listeners = function(t2) {
    return tt(this, t2, true);
  }, f.prototype.rawListeners = function(t2) {
    return tt(this, t2, false);
  }, f.listenerCount = function(t2, e2) {
    return "function" == typeof t2.listenerCount ? t2.listenerCount(e2) : et.call(t2, e2);
  }, f.prototype.listenerCount = et, f.prototype.eventNames = function() {
    return 0 < this._eventsCount ? Y(this._events) : [];
  };
  var l = {}, p = (l.EventEmitter = c, l.timeout = function(t2, e2) {
    var r2 = W(e2);
    return Promise.race([t2.finally(function() {
      clearTimeout(r2.timeout);
    }), r2.then(function() {
      throw new H();
    })]);
  }, l.promise = function(s2, a2, u2, c2) {
    return void 0 === u2 && (u2 = "error"), new Promise(function(e2, r2) {
      var t2, n2 = function() {
        clearTimeout(t2), s2.removeListener(a2, i2), s2.removeListener(u2, o2);
      };
      function o2(t3) {
        r2(t3), n2();
      }
      function i2(t3) {
        e2(t3), n2();
      }
      s2.once(a2, i2), u2 && s2.once(u2, o2), c2 && (t2 = setTimeout(function() {
        n2(), r2(new H());
      }, c2));
    });
  }, l.Deferred = function() {
    var r2 = this;
    this.promise = new Promise(function(t2, e2) {
      r2.resolve = t2, r2.reject = e2;
    });
  }, {});
  (p = function(t2, e2) {
    return e2 = e2 || t2.slice(0), t2.raw = e2, t2;
  }).__esModule = true;
  function ot(t2) {
    var e2, r2, n2 = t2.indexOf("/");
    return -1 !== n2 && (r2 = t2.slice(n2 + 1), t2 = t2.slice(0, n2)), -1 !== (n2 = t2.indexOf("@")) && (e2 = t2.slice(0, n2), t2 = t2.slice(n2 + 1)), new Rt(e2, t2, r2);
  }
  var it, st, at, ut, ct, lt, ft, ht, pt, dt, mt, vt, yt, gt, bt, wt, _t, xt, St, Pt, jt, Et, At, Ot, Lt, kt, Mt, Ct, Tt, Nt, d = {}, m = t(p.default = p), p = (d.detect = function(t2) {
    return !!t2 && -1 !== t2.replaceAll(String.raw(it = it || (0, m.default)([void 0], ["\\20"])), "").replaceAll(String.raw(st = st || (0, m.default)([void 0], ["\\22"])), "").replaceAll(String.raw(at = at || (0, m.default)([void 0], ["\\26"])), "").replaceAll(String.raw(ut = ut || (0, m.default)([void 0], ["\\27"])), "").replaceAll(String.raw(ct = ct || (0, m.default)([void 0], ["\\2f"])), "").replaceAll(String.raw(lt = lt || (0, m.default)([void 0], ["\\3a"])), "").replaceAll(String.raw(ft = ft || (0, m.default)([void 0], ["\\3c"])), "").replaceAll(String.raw(ht = ht || (0, m.default)([void 0], ["\\3e"])), "").replaceAll(String.raw(pt = pt || (0, m.default)([void 0], ["\\40"])), "").replaceAll(String.raw(dt = dt || (0, m.default)([void 0], ["\\5c"])), "").search(/[ "&'/:<>@\\]/g);
  }, d.escape = function(t2) {
    return null === t2 ? null : t2.replaceAll(/^\s+|\s+$/g, "").replaceAll("\\", String.raw(mt = mt || (0, m.default)([void 0], ["\\5c"]))).replaceAll(" ", String.raw(vt = vt || (0, m.default)([void 0], ["\\20"]))).replaceAll('"', String.raw(yt = yt || (0, m.default)([void 0], ["\\22"]))).replaceAll("&", String.raw(gt = gt || (0, m.default)([void 0], ["\\26"]))).replaceAll("'", String.raw(bt = bt || (0, m.default)([void 0], ["\\27"]))).replaceAll("/", String.raw(wt = wt || (0, m.default)([void 0], ["\\2f"]))).replaceAll(":", String.raw(_t = _t || (0, m.default)([void 0], ["\\3a"]))).replaceAll("<", String.raw(xt = xt || (0, m.default)([void 0], ["\\3c"]))).replaceAll(">", String.raw(St = St || (0, m.default)([void 0], ["\\3e"]))).replaceAll("@", String.raw(Pt = Pt || (0, m.default)([void 0], ["\\40"])));
  }, d.unescape = function(t2) {
    return null === t2 ? null : t2.replaceAll(String.raw(jt = jt || (0, m.default)([void 0], ["\\20"])), " ").replaceAll(String.raw(Et = Et || (0, m.default)([void 0], ["\\22"])), '"').replaceAll(String.raw(At = At || (0, m.default)([void 0], ["\\26"])), "&").replaceAll(String.raw(Ot = Ot || (0, m.default)([void 0], ["\\27"])), "'").replaceAll(String.raw(Lt = Lt || (0, m.default)([void 0], ["\\2f"])), "/").replaceAll(String.raw(kt = kt || (0, m.default)([void 0], ["\\3a"])), ":").replaceAll(String.raw(Mt = Mt || (0, m.default)([void 0], ["\\3c"])), "<").replaceAll(String.raw(Ct = Ct || (0, m.default)([void 0], ["\\3e"])), ">").replaceAll(String.raw(Tt = Tt || (0, m.default)([void 0], ["\\40"])), "@").replaceAll(String.raw(Nt = Nt || (0, m.default)([void 0], ["\\5c"])), "\\");
  }, (() => {
    function t2(t3, e3, r2) {
      if ("string" != typeof e3 || !e3) throw new TypeError("Invalid domain.");
      this.setDomain(e3), this.setLocal("string" == typeof t3 ? t3 : ""), this.setResource("string" == typeof r2 ? r2 : "");
    }
    var e2 = t2.prototype;
    return e2[Symbol.toPrimitive] = function(t3) {
      return "number" === t3 ? NaN : this.toString();
    }, e2.toString = function(t3) {
      var e3 = this._domain;
      return this._local && (e3 = this.getLocal(t3) + "@" + e3), e3 = this._resource ? e3 + "/" + this._resource : e3;
    }, e2.bare = function() {
      return this._resource ? new t2(this._local, this._domain, null) : this;
    }, e2.equals = function(t3) {
      return this._local === t3._local && this._domain === t3._domain && this._resource === t3._resource;
    }, e2.setLocal = function(t3, e3) {
      return (e3 = e3 || d.detect(t3)) && (t3 = d.escape(t3)), this._local = t3 && t3.toLowerCase(), this;
    }, e2.getLocal = function(t3) {
      return (t3 = void 0 === t3 ? false : t3) ? d.unescape(this._local) : this._local;
    }, e2.setDomain = function(t3) {
      return this._domain = t3.toLowerCase(), this;
    }, e2.getDomain = function() {
      return this._domain;
    }, e2.setResource = function(t3) {
      return this._resource = t3, this;
    }, e2.getResource = function() {
      return this._resource;
    }, t2;
  })()), Rt = (Object.defineProperty(p.prototype, "local", { get: p.prototype.getLocal, set: p.prototype.setLocal }), Object.defineProperty(p.prototype, "domain", { get: p.prototype.getDomain, set: p.prototype.setDomain }), Object.defineProperty(p.prototype, "resource", { get: p.prototype.getResource, set: p.prototype.setResource }), p), v = {}, Xt = t(a);
  function qt() {
    for (var t2 = arguments.length, e2 = new Array(t2), r2 = 0; r2 < t2; r2++) e2[r2] = arguments[r2];
    return e2[1] || e2[2] ? (0, Xt.default)(Rt, e2) : ot.apply(void 0, e2);
  }
  (v = qt.bind()).jid = qt, v.JID = Rt, v.equal = function(t2, e2) {
    return t2.equals(e2);
  }, v.detectEscape = d.detect, v.escapeLocal = d.escape, v.unescapeLocal = d.unescape, v.parse = ot;
  var w = {}, It = { "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&apos;" };
  function Ft(t2) {
    return It[t2];
  }
  var zt = { "&amp;": "&", "&lt;": "<", "&gt;": ">", "&quot;": '"', "&apos;": "'" };
  function Dt(t2) {
    if ("#" === t2[1]) {
      var e2 = "x" === t2[2] ? parseInt(t2.slice(3), 16) : parseInt(t2.slice(2), 10);
      if (9 === e2 || 10 === e2 || 13 === e2 || 32 <= e2 && e2 <= 55295 || 57344 <= e2 && e2 <= 65533 || 65536 <= e2 && e2 <= 1114111) return String.fromCodePoint(e2);
      throw new Error("Illegal XML character 0x" + e2.toString(16));
    }
    if (zt[t2]) return zt[t2];
    throw new Error("Illegal XML entity " + t2);
  }
  function y(t2, e2) {
    var r2, n2 = "undefined" != typeof Symbol && t2[Symbol.iterator] || t2["@@iterator"];
    if (n2) return (n2 = n2.call(t2)).next.bind(n2);
    if (Array.isArray(t2) || (n2 = ((t3, e3) => {
      var r3;
      if (t3) return "string" == typeof t3 ? Bt(t3, e3) : "Map" === (r3 = "Object" === (r3 = {}.toString.call(t3).slice(8, -1)) && t3.constructor ? t3.constructor.name : r3) || "Set" === r3 ? Array.from(t3) : "Arguments" === r3 || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r3) ? Bt(t3, e3) : void 0;
    })(t2)) || e2 && t2 && "number" == typeof t2.length) return n2 && (t2 = n2), r2 = 0, function() {
      return r2 >= t2.length ? { done: true } : { done: false, value: t2[r2++] };
    };
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function Bt(t2, e2) {
    (null == e2 || e2 > t2.length) && (e2 = t2.length);
    for (var r2 = 0, n2 = Array(e2); r2 < e2; r2++) n2[r2] = t2[r2];
    return n2;
  }
  w.escapeXML = function(t2) {
    return t2.replace(/["&'<>]/g, Ft);
  }, w.escapeXMLText = function(t2) {
    return t2.replace(/[&<>]/g, Ft);
  }, w.unescapeXML = function(t2) {
    for (var e2, r2 = "", n2 = -1, o2 = 0; -1 !== (e2 = t2.indexOf("&", o2)) && -1 !== (n2 = t2.indexOf(";", e2 + 1)); ) r2 = r2 + t2.slice(o2, e2) + Dt(t2.slice(e2, n2 + 1)), o2 = n2 + 1;
    return 0 === o2 ? t2 : r2 + t2.substring(o2);
  }, w.unescapeXMLText = function(t2) {
    return t2.replace(/&(amp|#38|lt|#60|gt|#62);/g, Dt);
  };
  var p = (() => {
    function r2(t3, e2) {
      this.name = t3, this.parent = null, this.children = [], this.attrs = {}, this.setAttrs(e2);
    }
    var t2 = r2.prototype;
    return t2.is = function(t3, e2) {
      return this.getName() === t3 && (!e2 || this.getNS() === e2);
    }, t2.getName = function() {
      var t3 = this.name.indexOf(":");
      return 0 <= t3 ? this.name.slice(t3 + 1) : this.name;
    }, t2.getNS = function() {
      var t3 = this.name.indexOf(":");
      return 0 <= t3 ? (t3 = this.name.slice(0, t3), this.findNS(t3)) : this.findNS();
    }, t2.findNS = function(t3) {
      return t3 ? this.attrs["xmlns:" + t3] || (this.parent ? this.parent.findNS(t3) : void 0) : this.attrs.xmlns || (this.parent ? this.parent.findNS() : void 0);
    }, t2.getXmlns = function() {
      var t3, e2 = {};
      for (t3 in this.parent && (e2 = this.parent.getXmlns()), this.attrs) {
        var r3 = t3.match("xmlns:?(.*)");
        this.attrs.hasOwnProperty(t3) && r3 && (e2[this.attrs[t3]] = r3[1]);
      }
      return e2;
    }, t2.setAttrs = function(t3) {
      "string" == typeof t3 ? this.attrs.xmlns = t3 : t3 && Object.assign(this.attrs, t3);
    }, t2.getAttr = function(t3, e2) {
      var r3;
      return e2 ? (r3 = this.getXmlns())[e2] ? this.attrs[[r3[e2], t3].join(":")] : null : this.attrs[t3];
    }, t2.getChild = function(t3, e2) {
      return this.getChildren(t3, e2)[0];
    }, t2.getChildren = function(t3, e2) {
      for (var r3 = [], n2 = y(this.children); !(o2 = n2()).done; ) {
        var o2 = o2.value;
        !o2.getName || o2.getName() !== t3 || e2 && o2.getNS() !== e2 || r3.push(o2);
      }
      return r3;
    }, t2.getChildByAttr = function(t3, e2, r3, n2) {
      return this.getChildrenByAttr(t3, e2, r3, n2)[0];
    }, t2.getChildrenByAttr = function(t3, e2, r3, n2) {
      for (var o2 = [], i2 = y(this.children); !(s2 = i2()).done; ) {
        var s2 = s2.value;
        !s2.attrs || s2.attrs[t3] !== e2 || r3 && s2.getNS() !== r3 || o2.push(s2), n2 && s2.getChildrenByAttr && o2.push(s2.getChildrenByAttr(t3, e2, r3, true));
      }
      return o2 = n2 ? o2.flat() : o2;
    }, t2.getChildrenByFilter = function(t3, e2) {
      for (var r3 = [], n2 = y(this.children); !(o2 = n2()).done; ) {
        var o2 = o2.value;
        t3(o2) && r3.push(o2), e2 && o2.getChildrenByFilter && r3.push(o2.getChildrenByFilter(t3, true));
      }
      return r3 = e2 ? r3.flat() : r3;
    }, t2.getText = function() {
      for (var t3 = "", e2 = y(this.children); !(r3 = e2()).done; ) {
        var r3 = r3.value;
        "string" != typeof r3 && "number" != typeof r3 || (t3 += r3);
      }
      return t3;
    }, t2.getChildText = function(t3, e2) {
      t3 = this.getChild(t3, e2);
      return t3 ? t3.getText() : null;
    }, t2.getChildElements = function() {
      return this.getChildrenByFilter(function(t3) {
        return t3 instanceof r2;
      });
    }, t2.root = function() {
      return this.parent ? this.parent.root() : this;
    }, t2.up = function() {
      return this.parent || this;
    }, t2.c = function(t3, e2) {
      return this.cnode(new r2(t3, e2));
    }, t2.cnode = function(t3) {
      return this.children.push(t3), "object" == typeof t3 && (t3.parent = this), t3;
    }, t2.append = function() {
      for (var t3 = arguments.length, e2 = new Array(t3), r3 = 0; r3 < t3; r3++) e2[r3] = arguments[r3];
      for (var n2 = 0, o2 = e2; n2 < o2.length; n2++) {
        var i2 = o2[n2];
        this.children.push(i2), "object" == typeof i2 && (i2.parent = this);
      }
    }, t2.prepend = function() {
      for (var t3 = arguments.length, e2 = new Array(t3), r3 = 0; r3 < t3; r3++) e2[r3] = arguments[r3];
      for (var n2 = 0, o2 = e2; n2 < o2.length; n2++) {
        var i2 = o2[n2];
        this.children.unshift(i2), "object" == typeof i2 && (i2.parent = this);
      }
    }, t2.t = function(t3) {
      return this.children.push(t3), this;
    }, t2.remove = function(e2, r3) {
      return this.children = this.children.filter("string" == typeof e2 ? function(t3) {
        return !(t3.is && t3.is(e2, r3));
      } : function(t3) {
        return t3 !== e2;
      }), this;
    }, t2.text = function(t3) {
      return t3 && 1 === this.children.length ? (this.children[0] = t3, this) : this.getText();
    }, t2.attr = function(t3, e2) {
      return void 0 !== e2 || null === e2 ? (this.attrs || (this.attrs = {}), this.attrs[t3] = e2, this) : this.attrs[t3];
    }, t2.toString = function() {
      var e2 = "";
      return this.write(function(t3) {
        e2 += t3;
      }), e2;
    }, t2._addChildren = function(t3) {
      t3(">");
      for (var e2 = y(this.children); !(r3 = e2()).done; ) {
        var r3 = r3.value;
        null != r3 && (r3.write ? r3.write(t3) : "string" == typeof r3 ? t3(w.escapeXMLText(r3)) : r3.toString && t3(w.escapeXMLText(r3.toString(10))));
      }
      t3("</"), t3(this.name), t3(">");
    }, t2.write = function(t3) {
      for (var e2 in t3("<"), t3(this.name), this.attrs) {
        var r3 = this.attrs[e2];
        null != r3 && (t3(" "), t3(e2), t3('="'), t3(w.escapeXML("string" == typeof r3 ? r3 : r3.toString(10))), t3('"'));
      }
      0 === this.children.length ? t3("/>") : this._addChildren(t3);
    }, r2;
  })(), Ut = (p.prototype.tree = p.prototype.root, p);
  function Wt(t2, e2) {
    var r2, n2 = "undefined" != typeof Symbol && t2[Symbol.iterator] || t2["@@iterator"];
    if (n2) return (n2 = n2.call(t2)).next.bind(n2);
    if (Array.isArray(t2) || (n2 = ((t3, e3) => {
      var r3;
      if (t3) return "string" == typeof t3 ? $t(t3, e3) : "Map" === (r3 = "Object" === (r3 = {}.toString.call(t3).slice(8, -1)) && t3.constructor ? t3.constructor.name : r3) || "Set" === r3 ? Array.from(t3) : "Arguments" === r3 || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r3) ? $t(t3, e3) : void 0;
    })(t2)) || e2 && t2 && "number" == typeof t2.length) return n2 && (t2 = n2), r2 = 0, function() {
      return r2 >= t2.length ? { done: true } : { done: false, value: t2[r2++] };
    };
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function $t(t2, e2) {
    (null == e2 || e2 > t2.length) && (e2 = t2.length);
    for (var r2 = 0, n2 = Array(e2); r2 < e2; r2++) n2[r2] = t2[r2];
    return n2;
  }
  var Ht = function(t2, e2) {
    if ("object" == typeof e2 && null !== e2) {
      delete e2.__source, delete e2.__self;
      for (var r2 = 0, n2 = Object.entries(e2); r2 < n2.length; r2++) {
        var o2 = n2[r2], i2 = o2[0], o2 = o2[1];
        null == o2 ? delete e2[i2] : e2[i2] = o2.toString(10);
      }
    }
    for (var s2 = new Ut(t2, e2), a2 = arguments.length, u2 = new Array(2 < a2 ? a2 - 2 : 0), c2 = 2; c2 < a2; c2++) u2[c2 - 2] = arguments[c2];
    for (var l2 = 0, f2 = u2; l2 < f2.length; l2++) !function t3(e3, r3) {
      if (Array.isArray(r3)) for (var n3, o3 = Wt(r3); !(n3 = o3()).done; ) t3(e3, n3.value);
      else "" !== r3 && null != r3 && true !== r3 && false !== r3 && e3.cnode(r3);
    }(s2, f2[l2]);
    return s2;
  }, Kt = t(r), Yt = ((e2) => {
    function t2() {
      var c2, l2, f2, h2, p2, d2, m2, v2, y2, t3 = e2.call(this) || this, g2 = 0, b2 = 0;
      return t3._handleTagOpening = function(t4, e3, r2) {
        t4 ? this.emit("endElement", e3, false) : (this.emit("startElement", e3, r2), d2 && this.emit("endElement", e3, true));
      }, t3.write = function(e3) {
        "string" != typeof e3 && (e3 = e3.toString());
        var r2 = 0;
        function t4() {
          var t5;
          if ("number" == typeof b2) return t5 = e3.slice(b2, r2), b2 = void 0, t5;
        }
        for (c2 && (e3 = c2 + e3, r2 += l2 ? 0 : c2.length, l2 = false, c2 = null); r2 < e3.length; r2++) {
          switch (g2) {
            case 0:
              var n2 = e3.indexOf("<", r2);
              -1 !== n2 && r2 !== n2 && (r2 = n2);
              break;
            case 8:
              n2 = e3.indexOf(v2, r2);
              -1 !== n2 && (r2 = n2);
              break;
            case 1:
              var o2 = e3.indexOf("-->", r2);
              -1 !== o2 && (r2 = o2 + 2);
              break;
            case 10:
              o2 = e3.indexOf("]]>", r2);
              -1 !== o2 && (r2 = o2 + 2);
          }
          var i2, s2, a2, u2 = e3.charCodeAt(r2);
          switch (g2) {
            case 0:
              60 === u2 && ((i2 = t4()) && this.emit("text", w.unescapeXML(i2)), g2 = 3, b2 = r2 + 1, h2 = {});
              break;
            case 9:
              93 === u2 && ("]>" === e3.substr(r2 + 1, 2) ? ((i2 = t4()) && this.emit("text", i2), g2 = 0) : e3.length < r2 + 2 && (l2 = true, r2 = e3.length));
              break;
            case 3:
              47 === u2 && b2 === r2 ? (b2 = r2 + 1, p2 = true) : 33 === u2 ? "[CDATA[" === e3.substr(r2 + 1, 7) ? (b2 = r2 + 8, g2 = 9) : e3.length < r2 + 8 && "[CDATA[".startsWith(e3.slice(r2 + 1)) ? (l2 = true, r2 = e3.length) : (b2 = void 0, g2 = 1) : 63 === u2 ? (b2 = void 0, g2 = 2) : (u2 <= 32 || 47 === u2 || 62 === u2) && (f2 = t4(), r2--, g2 = 4);
              break;
            case 1:
              62 === u2 && (a2 = e3.charCodeAt(r2 - 1), s2 = e3.charCodeAt(r2 - 2), 45 === a2 && 45 === s2 || 93 === a2 && 93 === s2) && (g2 = 0);
              break;
            case 2:
              62 === u2 && 63 === e3.charCodeAt(r2 - 1) && (g2 = 0);
              break;
            case 4:
              62 === u2 ? (this._handleTagOpening(p2, f2, h2), d2 = p2 = h2 = f2 = void 0, g2 = 0, b2 = r2 + 1) : 47 === u2 ? d2 = true : 32 < u2 && (b2 = r2, g2 = 5);
              break;
            case 5:
              (u2 <= 32 || 61 === u2) && (y2 = t4(), r2--, g2 = 6);
              break;
            case 6:
              61 === u2 && (g2 = 7);
              break;
            case 7:
              34 !== u2 && 39 !== u2 || (v2 = 34 === (m2 = u2) ? '"' : "'", g2 = 8, b2 = r2 + 1);
              break;
            case 8:
              u2 === m2 && (a2 = w.unescapeXML(t4()), h2[y2] = a2, y2 = void 0, g2 = 4);
          }
        }
        "number" == typeof b2 && b2 <= e3.length && (c2 = e3.slice(b2), b2 = 0);
      }, t3;
    }
    return (0, Kt.default)(t2, e2), t2.prototype.end = function(t3) {
      t3 && this.write(t3), this.write = function() {
      };
    }, t2;
  })(c.EventEmitter), Jt = t(r), g = ((o2) => {
    function t2() {
      for (var t3, e2 = arguments.length, r2 = new Array(e2), n2 = 0; n2 < e2; n2++) r2[n2] = arguments[n2];
      return (t3 = o2.call.apply(o2, [this].concat(r2)) || this).name = "XMLError", t3;
    }
    return (0, Jt.default)(t2, o2), t2;
  })((0, t(u).default)(Error)), Gt = t(r), p = ((r2) => {
    function t2() {
      var t3 = r2.call(this) || this, e3 = new Yt();
      return t3.root = null, t3.cursor = null, e3.on("startElement", t3.onStartElement.bind(t3)), e3.on("endElement", t3.onEndElement.bind(t3)), e3.on("text", t3.onText.bind(t3)), t3.parser = e3, t3;
    }
    (0, Gt.default)(t2, r2);
    var e2 = t2.prototype;
    return e2.onStartElement = function(t3, e3) {
      var t3 = new Ut(t3, e3), e3 = this.root, r3 = this.cursor;
      e3 ? r3 !== e3 && r3.append(t3) : (this.root = t3, this.emit("start", t3)), this.cursor = t3;
    }, e2.onEndElement = function(t3) {
      var e3 = this.root, r3 = this.cursor;
      t3 !== r3.name ? this.emit("error", new g(r3.name + " must be closed.")) : r3 === e3 ? this.emit("end", e3) : r3.parent ? this.cursor = r3.parent : (r3.parent = e3, this.emit("element", r3), this.cursor = e3);
    }, e2.onText = function(t3) {
      var e3 = this.cursor;
      e3 ? e3.t(t3) : this.emit("error", new g(t3 + " must be a child."));
    }, e2.write = function(t3) {
      this.parser.write(t3);
    }, e2.end = function(t3) {
      t3 && this.parser.write(t3);
    }, t2;
  })(c), Qt = (p.XMLError = g, p), b = {};
  b = function() {
    return Ht.apply(void 0, arguments);
  }, Object.assign(b, { Element: Ut, createElement: Ht, Parser: Qt, escapeXML: w.escapeXML, unescapeXML: w.unescapeXML, escapeXMLText: w.escapeXMLText, unescapeXMLText: w.unescapeXMLText, XMLError: g });
  var Vt = t(r), p = ((o2) => {
    function t2(t3, e2, r2) {
      var n2 = o2.call(this, t3 + (e2 ? " - " + e2 : "")) || this;
      return n2.name = "XMPPError", n2.condition = t3, n2.text = e2, n2.application = r2, n2;
    }
    return (0, Vt.default)(t2, o2), t2.fromElement = function(t3) {
      var e2, r2, n2 = t3.getChildElements(), o3 = n2[0], i2 = n2[1], n2 = n2[2], i2 = (i2 && (i2.is("text") ? e2 = i2 : i2 && (r2 = i2), n2) && (r2 = n2), new this(o3.name, e2 ? e2.text() : "", r2));
      return i2.element = t3, i2;
    }, t2;
  })((0, t(u).default)(Error)), Zt = t(r), te = ((o2) => {
    function t2() {
      for (var t3, e2 = arguments.length, r2 = new Array(e2), n2 = 0; n2 < e2; n2++) r2[n2] = arguments[n2];
      return (t3 = o2.call.apply(o2, [this].concat(r2)) || this).name = "StreamError", t3;
    }
    return (0, Zt.default)(t2, o2), t2;
  })(p), _ = {};
  function ee(t2) {
    var t2 = new URL(t2), e2 = t2.port, r2 = t2.hostname;
    return { port: e2, hostname: r2 = "[::1]" === r2 ? "::1" : r2, protocol: t2.protocol };
  }
  function re(t2) {
    t2 = ee("http://" + t2);
    return { port: t2.port, hostname: t2.hostname };
  }
  Object.assign(_, { parseURI: ee, parseHost: re, parseService: function(t2) {
    return (t2.includes("://") ? ee : re)(t2);
  } });
  var ne = t(r);
  function x() {
  }
  function oe(t2, e2) {
    if (!e2) return t2 && t2.then ? t2.then(x) : Promise.resolve();
  }
  function ie(t2, e2) {
    try {
      var r2 = t2();
    } catch (t3) {
      return e2(t3);
    }
    return r2 && r2.then ? r2.then(void 0, e2) : r2;
  }
  function se(t2, e2) {
    return t2 && t2.then ? t2.then(e2) : e2(t2);
  }
  function S(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  function ae(t2, e2) {
    var r2, n2 = "undefined" != typeof Symbol && t2[Symbol.iterator] || t2["@@iterator"];
    if (n2) return (n2 = n2.call(t2)).next.bind(n2);
    if (Array.isArray(t2) || (n2 = ((t3, e3) => {
      var r3;
      if (t3) return "string" == typeof t3 ? ue(t3, e3) : "Map" === (r3 = "Object" === (r3 = {}.toString.call(t3).slice(8, -1)) && t3.constructor ? t3.constructor.name : r3) || "Set" === r3 ? Array.from(t3) : "Arguments" === r3 || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r3) ? ue(t3, e3) : void 0;
    })(t2)) || e2 && t2 && "number" == typeof t2.length) return n2 && (t2 = n2), r2 = 0, function() {
      return r2 >= t2.length ? { done: true } : { done: false, value: t2[r2++] };
    };
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function ue(t2, e2) {
    (null == e2 || e2 > t2.length) && (e2 = t2.length);
    for (var r2 = 0, n2 = Array(e2); r2 < e2; r2++) n2[r2] = t2[r2];
    return n2;
  }
  var P = l.promise, ce = _.parseHost, le = _.parseService, _ = ((r2) => {
    function t2(t3) {
      var e3;
      return void 0 === t3 && (t3 = {}), (e3 = r2.call(this) || this).jid = null, e3.timeout = 2e3, e3.options = t3, e3.socketListeners = /* @__PURE__ */ Object.create(null), e3.parserListeners = /* @__PURE__ */ Object.create(null), e3.status = "offline", e3.socket = null, e3.parser = null, e3.root = null, e3;
    }
    (0, ne.default)(t2, r2);
    var e2 = t2.prototype;
    return e2._reset = function() {
      this.jid = null, this.status = "offline", this._detachSocket(), this._detachParser();
    }, e2._streamError = function(t3, e3) {
      try {
        var r3 = this;
        return S(se(ie(function() {
          return oe(r3.send(b("stream:error", {}, [b(t3, { xmlns: "urn:ietf:params:xml:ns:xmpp-streams" }, e3)])));
        }, x), function() {
          return r3._end();
        }));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2._onData = function(t3) {
      t3 = t3.toString("utf8");
      this.emit("input", t3), this.parser.write(t3);
    }, e2._onParserError = function(t3) {
      this._streamError("bad-format"), this._detachParser(), this.emit("error", t3);
    }, e2._attachSocket = function(t3) {
      var r3 = this, t3 = (this.socket = t3, this.socketListeners);
      t3.data = this._onData.bind(this), t3.close = function(t4, e3) {
        r3._reset(), r3._status("disconnect", { clean: !t4, event: e3 });
      }, t3.connect = function() {
        r3._status("connect");
      }, t3.error = function(t4) {
        r3.emit("error", t4);
      }, this.socket.on("close", t3.close), this.socket.on("data", t3.data), this.socket.on("error", t3.error), this.socket.on("connect", t3.connect);
    }, e2._detachSocket = function() {
      for (var t3 = this.socketListeners, e3 = this.socket, r3 = ae(Object.getOwnPropertyNames(t3)); !(n2 = r3()).done; ) {
        var n2 = n2.value;
        e3.removeListener(n2, t3[n2]), delete t3[n2];
      }
      return this.socket = null, e3;
    }, e2._onElement = function(t3) {
      var e3 = t3.is("error", "http://etherx.jabber.org/streams");
      e3 && this._onStreamError(t3), this.emit("element", t3), this.emit(this.isStanza(t3) ? "stanza" : "nonza", t3), e3 && this._end();
    }, e2._onStreamError = function(t3) {
      t3 = te.fromElement(t3);
      if ("see-other-host" === t3.condition) return this._onSeeOtherHost(t3);
      this.emit("error", t3);
    }, e2._onSeeOtherHost = function(t3) {
      try {
        var n2 = this, e3 = le(n2.options.service).protocol, r3 = t3.element.getChildText("see-other-host"), o2 = ce(r3).port ? (e3 || "xmpp:") + "//" + r3 : (e3 ? e3 + "//" : "") + r3;
        return S(((t4) => {
          if (t4 && t4.then) return t4.then(x);
        })(ie(function() {
          return S(P(n2, "disconnect"), function() {
            var t4 = n2.options, e4 = t4.domain, r4 = t4.lang;
            return S(n2.connect(o2), function() {
              return oe(n2.open({ domain: e4, lang: r4 }));
            });
          });
        }, function(t4) {
          n2.emit("error", t4);
        })));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2._attachParser = function(t3) {
      var e3 = this, t3 = (this.parser = t3, this.parserListeners);
      t3.element = this._onElement.bind(this), t3.error = this._onParserError.bind(this), t3.end = function(t4) {
        e3._detachParser(), e3._status("close", t4);
      }, t3.start = function(t4) {
        e3._status("open", t4);
      }, this.parser.on("error", t3.error), this.parser.on("element", t3.element), this.parser.on("end", t3.end), this.parser.on("start", t3.start);
    }, e2._detachParser = function() {
      for (var t3 = this.parserListeners, e3 = ae(Object.getOwnPropertyNames(t3)); !(r3 = e3()).done; ) {
        var r3 = r3.value;
        this.parser.removeListener(r3, t3[r3]), delete t3[r3];
      }
      this.parser = null;
    }, e2._jid = function(t3) {
      return this.jid = v(t3), this.jid;
    }, e2._status = function(t3) {
      this.status = t3;
      for (var e3 = arguments.length, r3 = new Array(1 < e3 ? e3 - 1 : 0), n2 = 1; n2 < e3; n2++) r3[n2 - 1] = arguments[n2];
      this.emit.apply(this, ["status", t3].concat(r3)), this.emit.apply(this, [t3].concat(r3));
    }, e2._end = function() {
      try {
        var e3, t3 = this;
        return S(se(ie(function() {
          return S(t3.close(), function(t4) {
            e3 = t4;
          });
        }, x), function() {
          return se(ie(function() {
            return oe(t3.disconnect());
          }, x), function() {
            return e3;
          });
        }));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.start = function() {
      try {
        var e3 = this;
        if ("offline" !== e3.status) throw new Error("Connection is not offline");
        var t3 = e3.options, r3 = t3.service, n2 = t3.domain, o2 = t3.lang;
        return S(e3.connect(r3), function() {
          var t4 = P(e3, "online");
          return S(e3.open({ domain: n2, lang: o2 }), function() {
            return t4;
          });
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.connect = function(t3) {
      try {
        this._status("connecting", t3);
        var e3 = new this.Socket();
        return this._attachSocket(e3), e3.connect(this.socketParameters(t3)), S(P(e3, "connect"));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.disconnect = function(t3) {
      try {
        var e3 = this;
        return void 0 === t3 && (t3 = e3.timeout), e3.socket && e3._status("disconnecting"), e3.socket.end(), S(oe(P(e3.socket, "close", "error", t3)));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.open = function(t3) {
      try {
        var e3 = this, r3 = (e3._status("opening"), t3 = "string" == typeof t3 ? { domain: t3 } : t3), n2 = r3.domain, o2 = r3.lang, i2 = r3.timeout, s2 = void 0 === i2 ? e3.timeout : i2, a2 = e3.headerElement();
        return a2.attrs.to = n2, a2.attrs["xml:lang"] = o2, e3.root = a2, e3._attachParser(new e3.Parser()), S(e3.write(e3.header(a2)), function() {
          return P(e3, "open", "error", s2);
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.stop = function() {
      try {
        var e3 = this;
        return S(e3._end(), function(t3) {
          return "offline" !== e3.status && e3._status("offline", t3), t3;
        });
      } catch (t3) {
        return Promise.reject(t3);
      }
    }, e2.close = function(t3) {
      try {
        var e3 = this, r3 = (void 0 === t3 && (t3 = e3.timeout), e3.footer(e3.footerElement())), n2 = Promise.all([P(e3.parser, "end", "error", t3), e3.write(r3)]);
        return e3.parser && e3.socket && e3._status("closing"), S(n2, function(t4) {
          t4 = t4[0];
          return e3.root = null, t4;
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.restart = function() {
      try {
        this._detachParser();
        var t3 = this.options, e3 = t3.domain, r3 = t3.lang;
        return S(this.open({ domain: e3, lang: r3 }));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.send = function(t3) {
      try {
        var e3 = this;
        return t3.parent = e3.root, S(e3.write(t3.toString()), function() {
          e3.emit("send", t3);
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.sendReceive = function(t3, e3) {
      return void 0 === e3 && (e3 = this.timeout), Promise.all([this.send(t3), P(this, "element", "error", e3)]).then(function(t4) {
        return t4[1];
      });
    }, e2.write = function(n2) {
      var o2 = this;
      return new Promise(function(e3, r3) {
        "closing" === o2.status ? r3(new Error("Connection is closing")) : o2.socket.write(n2, function(t3) {
          if (t3) return r3(t3);
          o2.emit("output", n2), e3();
        });
      });
    }, e2.isStanza = function(t3) {
      t3 = t3.name;
      return "iq" === t3 || "message" === t3 || "presence" === t3;
    }, e2.isNonza = function(t3) {
      return !this.isStanza(t3);
    }, e2.header = function(t3) {
      return t3.toString();
    }, e2.headerElement = function() {
      return new b.Element("", { version: "1.0", xmlns: this.NS });
    }, e2.footer = function(t3) {
      return t3.toString();
    }, e2.footerElement = function() {
    }, e2.socketParameters = function() {
    }, t2;
  })(l.EventEmitter), fe = (_.prototype.NS = "", _.prototype.Socket = null, _.prototype.Parser = null, t(r)), j = ((r2) => {
    function t2(t3) {
      t3 = r2.call(this, t3) || this;
      return t3.transports = [], t3;
    }
    (0, fe.default)(t2, r2);
    var e2 = t2.prototype;
    return e2.send = function(t3) {
      for (var e3, r3 = arguments.length, n2 = new Array(1 < r3 ? r3 - 1 : 0), o2 = 1; o2 < r3; o2++) n2[o2 - 1] = arguments[o2];
      return (e3 = this.Transport.prototype.send).call.apply(e3, [this, t3].concat(n2));
    }, e2.sendMany = function() {
      for (var t3, e3 = arguments.length, r3 = new Array(e3), n2 = 0; n2 < e3; n2++) r3[n2] = arguments[n2];
      return (t3 = this.Transport.prototype.sendMany).call.apply(t3, [this].concat(r3));
    }, e2._findTransport = function(e3) {
      return this.transports.find(function(t3) {
        try {
          return void 0 !== t3.prototype.socketParameters(e3);
        } catch (t4) {
          return false;
        }
      });
    }, e2.connect = function(t3) {
      var e3 = this._findTransport(t3);
      if (e3) return this.Transport = e3, this.Socket = e3.prototype.Socket, this.Parser = e3.prototype.Parser, r2.prototype.connect.call(this, t3);
      throw new Error("No compatible connection method found.");
    }, e2.socketParameters = function() {
      var t3;
      return (t3 = this.Transport.prototype).socketParameters.apply(t3, arguments);
    }, e2.header = function() {
      var t3;
      return (t3 = this.Transport.prototype).header.apply(t3, arguments);
    }, e2.headerElement = function() {
      var t3;
      return (t3 = this.Transport.prototype).headerElement.apply(t3, arguments);
    }, e2.footer = function() {
      var t3;
      return (t3 = this.Transport.prototype).footer.apply(t3, arguments);
    }, e2.footerElement = function() {
      var t3;
      return (t3 = this.Transport.prototype).footerElement.apply(t3, arguments);
    }, t2;
  })(_);
  j.prototype.NS = "jabber:client";
  var E = {}, he = (E.Client = j, E.xml = b, E.jid = v, t(r));
  function pe() {
  }
  var de = ((r2) => {
    function t2(t3) {
      var e3 = r2.call(this) || this;
      return e3.delay = 1e3, e3.entity = t3, e3._timeout = null, e3;
    }
    (0, he.default)(t2, r2);
    var e2 = t2.prototype;
    return e2.scheduleReconnect = function() {
      var r3, e3 = this, n2 = this.entity, t3 = this.delay, o2 = this._timeout;
      clearTimeout(o2), this._timeout = setTimeout((r3 = function() {
        if ("disconnect" === n2.status) {
          var t4 = ((t5, e4) => {
            try {
              var r4 = t5();
            } catch (t6) {
              return e4(t6);
            }
            return r4 && r4.then ? r4.then(void 0, e4) : r4;
          })(function() {
            var t5 = e3.reconnect();
            if (true) return t5 && t5.then ? t5.then(pe) : Promise.resolve();
          }, pe);
          if (t4 && t4.then) return t4.then(pe);
        }
      }, function() {
        for (var t4 = [], e4 = 0; e4 < arguments.length; e4++) t4[e4] = arguments[e4];
        try {
          return Promise.resolve(r3.apply(this, t4));
        } catch (t5) {
          return Promise.reject(t5);
        }
      }), t3);
    }, e2.reconnect = function() {
      try {
        var t3 = this, e3 = t3.entity, r3 = (t3.emit("reconnecting"), e3.options), n2 = r3.service, o2 = r3.domain, i2 = r3.lang;
        return me(e3.connect(n2), function() {
          return me(e3.open({ domain: o2, lang: i2 }), function() {
            t3.emit("reconnected");
          });
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.start = function() {
      var t3 = this, e3 = this.entity, r3 = { disconnect: function() {
        t3.scheduleReconnect();
      } };
      this.listeners = r3, e3.on("disconnect", r3.disconnect);
    }, e2.stop = function() {
      var t3 = this.entity, e3 = this.listeners, r3 = this._timeout;
      t3.removeListener("disconnect", e3.disconnect), clearTimeout(r3);
    }, t2;
  })(l.EventEmitter);
  function me(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  var A = {}, ve = t(r);
  function ye(t2, e2) {
    var r2, n2 = "undefined" != typeof Symbol && t2[Symbol.iterator] || t2["@@iterator"];
    if (n2) return (n2 = n2.call(t2)).next.bind(n2);
    if (Array.isArray(t2) || (n2 = ((t3, e3) => {
      var r3;
      if (t3) return "string" == typeof t3 ? ge(t3, e3) : "Map" === (r3 = "Object" === (r3 = {}.toString.call(t3).slice(8, -1)) && t3.constructor ? t3.constructor.name : r3) || "Set" === r3 ? Array.from(t3) : "Arguments" === r3 || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r3) ? ge(t3, e3) : void 0;
    })(t2)) || e2 && t2 && "number" == typeof t2.length) return n2 && (t2 = n2), r2 = 0, function() {
      return r2 >= t2.length ? { done: true } : { done: false, value: t2[r2++] };
    };
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function ge(t2, e2) {
    (null == e2 || e2 > t2.length) && (e2 = t2.length);
    for (var r2 = 0, n2 = Array(e2); r2 < e2; r2++) n2[r2] = t2[r2];
    return n2;
  }
  var be = globalThis.WebSocket || A, we = "ECONNERROR", j = ((e2) => {
    function t2() {
      var t3 = e2.call(this) || this;
      return t3.listeners = /* @__PURE__ */ Object.create(null), t3;
    }
    (0, ve.default)(t2, e2);
    var r2 = t2.prototype;
    return r2.connect = function(t3) {
      this.url = t3, this._attachSocket(new be(t3, ["xmpp"]));
    }, r2._attachSocket = function(t3) {
      var n2 = this, t3 = (this.socket = t3, this.listeners);
      t3.open = function() {
        n2.emit("connect");
      }, t3.message = function(t4) {
        t4 = t4.data;
        return n2.emit("data", t4);
      }, t3.error = function(t4) {
        var e3 = n2.url, r3 = t4.error;
        r3 || ((r3 = new Error("WebSocket " + we + " " + e3)).errno = we, r3.code = we), r3.event = t4, r3.url = e3, n2.emit("error", r3);
      }, t3.close = function(t4) {
        n2._detachSocket(), n2.emit("close", !t4.wasClean, t4);
      }, this.socket.addEventListener("open", t3.open), this.socket.addEventListener("message", t3.message), this.socket.addEventListener("error", t3.error), this.socket.addEventListener("close", t3.close);
    }, r2._detachSocket = function() {
      delete this.url;
      for (var t3 = this.socket, e3 = this.listeners, r3 = ye(Object.getOwnPropertyNames(e3)); !(n2 = r3()).done; ) {
        var n2 = n2.value;
        t3.removeEventListener(n2, e3[n2]), delete e3[n2];
      }
      delete this.socket;
    }, r2.end = function() {
      this.socket.close();
    }, r2.write = function(t3, e3) {
      be === A ? this.socket.send(t3, e3) : (this.socket.send(t3), e3());
    }, t2;
  })(c), _e = t(r), c = b.Parser, xe = b.Element, Se = b.XMLError, c = ((t2) => {
    function e2() {
      return t2.apply(this, arguments) || this;
    }
    (0, _e.default)(e2, t2);
    var r2 = e2.prototype;
    return r2.onStartElement = function(t3, e3) {
      t3 = new xe(t3, e3), e3 = this.cursor;
      e3 && e3.append(t3), this.cursor = t3;
    }, r2.onEndElement = function(t3) {
      var e3 = this.cursor;
      t3 !== e3.name ? this.emit("error", new Se(e3.name + " must be closed.")) : e3.parent ? this.cursor = e3.parent : (e3.is("open", "urn:ietf:params:xml:ns:xmpp-framing") ? this.emit("start", e3) : e3.is("close", "urn:ietf:params:xml:ns:xmpp-framing") ? this.emit("end", e3) : this.emit("element", e3), this.cursor = null);
    }, e2;
  })(c), Pe = t(r);
  function je() {
  }
  var Ee = "undefined" != typeof Symbol ? Symbol.iterator || (Symbol.iterator = Symbol("Symbol.iterator")) : "@@iterator";
  function O(t2, e2, r2) {
    if (!t2.s) {
      if (r2 instanceof L) {
        if (!r2.s) return void (r2.o = O.bind(null, t2, e2));
        1 & e2 && (e2 = r2.s), r2 = r2.v;
      }
      r2 && r2.then ? r2.then(O.bind(null, t2, e2), O.bind(null, t2, 2)) : (t2.s = e2, t2.v = r2, (e2 = t2.o) && e2(t2));
    }
  }
  var L = (() => {
    function e2() {
    }
    return e2.prototype.then = function(r2, n2) {
      var o2 = new e2(), t2 = this.s;
      if (t2) {
        t2 = 1 & t2 ? r2 : n2;
        if (t2) {
          try {
            O(o2, 1, t2(this.v));
          } catch (t3) {
            O(o2, 2, t3);
          }
          return o2;
        }
        return this;
      }
      return this.o = function(t3) {
        try {
          var e3 = t3.v;
          1 & t3.s ? O(o2, 1, r2 ? r2(e3) : e3) : n2 ? O(o2, 1, n2(e3)) : O(o2, 2, e3);
        } catch (t4) {
          O(o2, 2, t4);
        }
      }, o2;
    }, e2;
  })();
  function Ae(t2) {
    return t2 instanceof L && 1 & t2.s;
  }
  function Oe(r2, n2, o2) {
    var i2, s2, a2 = -1;
    return function t2(e2) {
      try {
        for (; ++a2 < r2.length && (!o2 || !o2()); ) if ((e2 = n2(a2)) && e2.then) {
          if (!Ae(e2)) return void e2.then(t2, s2 = s2 || O.bind(null, i2 = new L(), 2));
          e2 = e2.v;
        }
        i2 ? O(i2, 1, e2) : i2 = e2;
      } catch (t3) {
        O(i2 = i2 || new L(), 2, t3);
      }
    }(), i2;
  }
  var Le = "urn:ietf:params:xml:ns:xmpp-framing";
  var _ = ((i2) => {
    function t2() {
      return i2.apply(this, arguments) || this;
    }
    (0, Pe.default)(t2, i2);
    var e2 = t2.prototype;
    return e2.send = function(t3) {
      var e3;
      !t3.attrs.xmlns && i2.prototype.isStanza.call(this, t3) && (t3.attrs.xmlns = "jabber:client");
      for (var r2 = arguments.length, n2 = new Array(1 < r2 ? r2 - 1 : 0), o2 = 1; o2 < r2; o2++) n2[o2 - 1] = arguments[o2];
      return (e3 = i2.prototype.send).call.apply(e3, [this, t3].concat(n2));
    }, e2.sendMany = function(t3) {
      try {
        var e3 = this;
        return r2 = ((t4) => {
          if (t4 && t4.then) return t4.then(je);
        })(((t4, e4, r3) => {
          if ("function" == typeof t4[Ee]) {
            var n3, o3, i3, s2 = function(t5) {
              try {
                for (; !((n3 = a2.next()).done || r3 && r3()); ) if ((t5 = e4(n3.value)) && t5.then) {
                  if (!Ae(t5)) return void t5.then(s2, i3 = i3 || O.bind(null, o3 = new L(), 2));
                  t5 = t5.v;
                }
                o3 ? O(o3, 1, t5) : o3 = t5;
              } catch (t6) {
                O(o3 = o3 || new L(), 2, t6);
              }
            }, a2 = t4[Ee]();
            if (s2(), a2.return) {
              var u2 = function(t5) {
                try {
                  n3.done || a2.return();
                } catch (t6) {
                }
                return t5;
              };
              if (o3 && o3.then) return o3.then(u2, function(t5) {
                throw u2(t5);
              });
              u2();
            }
            return o3;
          }
          if (!("length" in t4)) throw new TypeError("Object is not iterable");
          for (var c2 = [], l2 = 0; l2 < t4.length; l2++) c2.push(t4[l2]);
          return Oe(c2, function(t5) {
            return e4(c2[t5]);
          }, r3);
        })(t3, function(t4) {
          t4 = e3.send(t4);
          if (true) return t4 && t4.then ? t4.then(je) : Promise.resolve();
        })), o2 ? n2 ? n2(r2) : r2 : (r2 && r2.then || (r2 = Promise.resolve(r2)), n2 ? r2.then(n2) : r2);
      } catch (t4) {
        return Promise.reject(t4);
      }
      var r2, n2, o2;
    }, e2.footerElement = function() {
      return new b.Element("close", { xmlns: Le });
    }, e2.headerElement = function() {
      var t3 = i2.prototype.headerElement.call(this);
      return t3.name = "open", t3.attrs.xmlns = Le, t3;
    }, e2.socketParameters = function(t3) {
      return /^wss?:\/\//.test(t3) ? t3 : void 0;
    }, t2;
  })(_), ke = (_.prototype.Socket = j, _.prototype.NS = "jabber:client", _.prototype.Parser = c, _);
  function Me(t2, e2) {
    var r2, n2 = "undefined" != typeof Symbol && t2[Symbol.iterator] || t2["@@iterator"];
    if (n2) return (n2 = n2.call(t2)).next.bind(n2);
    if (Array.isArray(t2) || (n2 = ((t3, e3) => {
      var r3;
      if (t3) return "string" == typeof t3 ? Ce(t3, e3) : "Map" === (r3 = "Object" === (r3 = {}.toString.call(t3).slice(8, -1)) && t3.constructor ? t3.constructor.name : r3) || "Set" === r3 ? Array.from(t3) : "Arguments" === r3 || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r3) ? Ce(t3, e3) : void 0;
    })(t2)) || e2 && t2 && "number" == typeof t2.length) return n2 && (t2 = n2), r2 = 0, function() {
      return r2 >= t2.length ? { done: true } : { done: false, value: t2[r2++] };
    };
    throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
  }
  function Ce(t2, e2) {
    (null == e2 || e2 > t2.length) && (e2 = t2.length);
    for (var r2 = 0, n2 = Array(e2); r2 < e2; r2++) n2[r2] = t2[r2];
    return n2;
  }
  var Te = function(s2) {
    if (!Array.isArray(s2)) throw new TypeError("Middleware stack must be an array!");
    for (var t2, e2 = Me(s2); !(t2 = e2()).done; ) if ("function" != typeof t2.value) throw new TypeError("Middleware must be composed of functions!");
    return function(r2, n2) {
      var o2 = -1;
      return i2(0);
      function i2(t3) {
        if (t3 <= o2) return Promise.reject(new Error("next() called multiple times"));
        var e3 = s2[o2 = t3];
        if (!(e3 = t3 === s2.length ? n2 : e3)) return Promise.resolve();
        try {
          return Promise.resolve(e3(r2, i2.bind(null, t3 + 1)));
        } catch (t4) {
          return Promise.reject(t4);
        }
      }
    };
  };
  function Ne(t2, e2) {
    this.stanza = e2, this.entity = t2;
    var t2 = e2.name, r2 = (e2 = e2.attrs).type, e2 = e2.id;
    this.name = t2, this.id = e2 || "", this.type = "message" === t2 ? r2 || "normal" : "presence" === t2 ? r2 || "available" : r2 || "", this.from = null, this.to = null, this.local = "", this.domain = "", this.resource = "";
  }
  var Re = t(r), Xe = ((o2) => {
    function t2(t3, e2) {
      var r2 = o2.call(this, t3, e2) || this, n2 = t3.jid, t3 = t3.domain, n2 = e2.attrs.to || n2 && n2.toString(), e2 = e2.attrs.from || t3;
      return n2 && (r2.to = new v(n2)), e2 && (r2.from = new v(e2), r2.local = r2.from.local, r2.domain = r2.from.domain, r2.resource = r2.from.resource), r2;
    }
    return (0, Re.default)(t2, o2), t2;
  })(Ne), qe = t(r), Ie = ((o2) => {
    function t2(t3, e2) {
      var r2 = o2.call(this, t3, e2) || this, n2 = t3.jid, t3 = t3.domain, n2 = e2.attrs.from || n2 && n2.toString(), e2 = e2.attrs.to || t3;
      return n2 && (r2.from = new v(n2)), e2 && (r2.to = new v(e2), r2.local = r2.to.local, r2.domain = r2.to.domain, r2.resource = r2.to.resource), r2;
    }
    return (0, qe.default)(t2, o2), t2;
  })(Ne);
  function Fe(e2, r2, n2) {
    return function(t2) {
      t2 = new n2(e2, t2);
      return Te(r2)(t2);
    };
  }
  function ze(t2) {
    var e2 = t2.middleware;
    return e2.use(De()), { use: function(n2, o2, i2) {
      return e2.use(function(t3, e3) {
        var r2 = t3.stanza;
        return r2.is("features", "http://etherx.jabber.org/streams") && (r2 = r2.getChild(n2, o2)) ? i2(t3, e3, r2) : e3();
      });
    } };
  }
  var De = function() {
    return r2 = function(t2, e2) {
      var r3 = t2.stanza, n2 = t2.entity;
      if (!r3.is("features", "http://etherx.jabber.org/streams")) return e2();
      t2 = e2, r3 = function(t3) {
        !t3 && n2.jid && n2._status("online", n2.jid);
      };
      if (void 0) return r3 ? r3(t2()) : t2();
      try {
        var o2 = Promise.resolve(t2());
        return r3 ? o2.then(r3) : o2;
      } catch (t3) {
        return Promise.reject(t3);
      }
    }, function() {
      for (var t2 = [], e2 = 0; e2 < arguments.length; e2++) t2[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t2));
      } catch (t3) {
        return Promise.reject(t3);
      }
    };
    var r2;
  }, j = {};
  (j = function(t2) {
    throw new TypeError('"' + t2 + '" is read-only');
  }).__esModule = true, j.default = j;
  var Be = t(r), Ue = ((o2) => {
    function t2(t3, e2, r2, n2) {
      t3 = o2.call(this, t3, e2, r2) || this;
      return t3.type = n2, t3.name = "StanzaError", t3;
    }
    return (0, Be.default)(t2, o2), t2.fromElement = function(t3) {
      var e2 = o2.fromElement.call(this, t3);
      return e2.type = t3.attrs.type, e2;
    }, t2;
  })(p), We = t(a);
  t(j);
  function $e() {
  }
  function He(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  var Ke = l.Deferred;
  var Ye = l.timeout;
  var Je = (() => {
    function t2(t3) {
      var e3 = t3.entity, t3 = t3.middleware;
      this.handlers = /* @__PURE__ */ new Map(), this.entity = e3, this.middleware = t3;
    }
    var e2 = t2.prototype;
    return e2.start = function() {
      this.middleware.use(this._route.bind(this));
    }, e2._route = function(t3, e3) {
      var r2, n2 = t3.type, o2 = t3.id, i2 = t3.stanza;
      return r2 = (t3 = { name: t3.name, type: n2 }).name, t3 = t3.type, "iq" === r2 && ("error" === t3 || "result" === t3) && (r2 = this.handlers.get(o2)) ? ("error" === n2 ? r2.reject(Ue.fromElement(i2.getChild("error"))) : r2.resolve(i2), void this.handlers.delete(o2)) : e3();
    }, e2.request = function(e3, r2) {
      void 0 === r2 && (r2 = 3e4);
      try {
        var n2 = this, o2 = (e3.attrs.id || (e3.attrs.id = (() => {
          for (var t4; !t4; ) t4 = Math.random().toString(36).slice(2, 12);
          return t4;
        })()), new Ke());
        return n2.handlers.set(e3.attrs.id, o2), He((t3 = ((t4, e4) => {
          try {
            var r3 = t4();
          } catch (t5) {
            return e4(t5);
          }
          return r3 && r3.then ? r3.then(void 0, e4) : r3;
        })(function() {
          return He(n2.entity.send(e3), function() {
            var t4 = Ye(o2.promise, r2);
            if (true) return t4 && t4.then ? t4.then($e) : Promise.resolve();
          });
        }, function(t4) {
          throw n2.handlers.delete(e3.attrs.id), t4;
        }), i2 = function(t4) {
          return o2.promise;
        }, t3 && t3.then ? t3.then(i2) : i2(t3)));
      } catch (t4) {
        return Promise.reject(t4);
      }
      var t3, i2;
    }, e2._childRequest = function(t3, e3, r2) {
      for (var n2 = e3.name, o2 = e3.attrs.xmlns, i2 = arguments.length, s2 = new Array(3 < i2 ? i2 - 3 : 0), a2 = 3; a2 < i2; a2++) s2[a2 - 3] = arguments[a2];
      return this.request.apply(this, [b("iq", { type: t3, to: r2 }, e3)].concat(s2)).then(function(t4) {
        return t4.getChild(n2, o2);
      });
    }, e2.get = function() {
      try {
        for (var t3 = arguments.length, e3 = new Array(t3), r2 = 0; r2 < t3; r2++) e3[r2] = arguments[r2];
        return He(this._childRequest.apply(this, ["get"].concat(e3)));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, e2.set = function() {
      try {
        for (var t3 = arguments.length, e3 = new Array(t3), r2 = 0; r2 < t3; r2++) e3[r2] = arguments[r2];
        return He(this._childRequest.apply(this, ["set"].concat(e3)));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }, t2;
  })();
  var Ge = "urn:ietf:params:xml:ns:xmpp-stanzas";
  function Qe(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  function Ve(t2) {
    t2 = t2.stanza;
    return b("iq", { to: t2.attrs.from, from: t2.attrs.to, id: t2.attrs.id });
  }
  function Ze(t2, e2, r2) {
    t2 = Ve(t2);
    return t2.attrs.type = "error", r2 && t2.append(r2), t2.append(e2), t2;
  }
  function tr(t2, e2) {
    return b("error", { type: t2 }, b(e2, Ge));
  }
  function er(h2) {
    return function(r2, n2) {
      try {
        var t2, o2, i2;
        return (f2 = (l2 = r2).name, l2 = l2.type, "iq" !== f2 || "error" === l2 || "result" === l2) ? Qe(n2()) : (t2 = r2.stanza.getChildElements(), o2 = t2[0], u2 = t2, c2 = o2, "get" !== (a2 = (a2 = r2).type) && "set" !== a2 || 1 !== u2.length || !c2 ? Qe(Ze(r2, tr("modify", "bad-request"), o2)) : (r2.element = o2, Qe((e2 = ((t3, e3) => {
          try {
            var r3 = t3();
          } catch (t4) {
            return e3(t4);
          }
          return r3 && r3.then ? r3.then(void 0, e3) : r3;
        })(function() {
          var t3 = n2, e3 = function(t4) {
            i2 = t4;
          };
          if (void 0) return e3 ? e3(t3()) : t3();
          try {
            var r3 = Promise.resolve(t3());
            return e3 ? r3.then(e3) : r3;
          } catch (t4) {
            return Promise.reject(t4);
          }
        }, function(t3) {
          h2.emit("error", t3), i2 = tr("cancel", "internal-server-error");
        }), s2 = function() {
          return (i2 = i2 || tr("cancel", "service-unavailable")) instanceof b.Element && i2.is("error") ? Ze(r2, i2, o2) : (t3 = r2, e3 = i2 instanceof b.Element ? i2 : void 0, (t3 = Ve(t3)).attrs.type = "result", e3 && t3.append(e3), t3);
          var t3, e3;
        }, e2 && e2.then ? e2.then(s2) : s2(e2)))));
      } catch (t3) {
        return Promise.reject(t3);
      }
      var e2, s2, a2, u2, c2, l2, f2;
    };
  }
  function rr(r2, n2, o2, i2) {
    return function(t2, e2) {
      return t2.type !== r2 | !t2.element || !t2.element.is(o2, n2) ? e2() : i2(t2, e2);
    };
  }
  c = {};
  function nr(t2) {
    return t2.startsWith("https") || t2.startsWith("wss");
  }
  c.compare = function(t2, e2) {
    var r2 = nr(t2.uri) && !nr(e2.uri) ? -1 : !nr(t2.uri) && nr(e2.uri) ? 1 : 0;
    return 0 !== r2 || 0 !== (r2 = t2.method === e2.method ? 0 : "websocket" === t2.method ? -1 : "websocket" === e2.method ? 1 : "xbosh" === t2.method ? -1 : "xbosh" === e2.method ? 1 : "httppoll" === t2.method ? -1 : "httppoll" === e2.method ? 1 : 0) ? r2 : 0;
  };
  var or = {}, ir = globalThis.fetch || A, sr = c.compare;
  or.resolve = function(t2) {
    return ir("https://" + t2 + "/.well-known/host-meta").then(function(t3) {
      return t3.text();
    }).then(function(t3) {
      return ((t4) => {
        var e2 = new Qt(), r2 = null, n2 = null;
        if (e2.on("start", function(t5) {
          r2 = t5;
        }), e2.on("element", function(t5) {
          r2.append(t5);
        }), e2.on("error", function(t5) {
          n2 = t5;
        }), e2.write(t4), e2.end(), n2) throw n2;
        return r2;
      })(t3).getChildren("Link").filter(function(t4) {
        return ["urn:xmpp:alt-connections:websocket", "urn:xmpp:alt-connections:httppoll", "urn:xmpp:alt-connections:xbosh"].includes(t4.attrs.rel);
      }).map(function(t4) {
        t4 = t4.attrs;
        return { rel: t4.rel, href: t4.href, method: t4.rel.split(":").pop(), uri: t4.href };
      }).sort(sr);
    }).catch(function() {
      return [];
    });
  };
  var ar;
  function ur() {
  }
  ar = function() {
    return Promise.all([A.resolve ? A.resolve.apply(A, arguments) : Promise.resolve([]), or.resolve.apply(or, arguments)]).then(function(t2) {
      var e2 = t2[0];
      return [].concat(e2, t2[1]);
    });
  }, A.resolve && (ar.dns = A), ar.http = or;
  var cr = mr(function(e2, r2) {
    var n2 = false;
    if (0 === r2.length) throw new Error("Couldn't connect");
    var t2 = r2.shift(), o2 = e2._findTransport(t2);
    if (!o2) return cr(e2, r2);
    e2._status("connecting", t2);
    var i2, s2 = o2.prototype.socketParameters(t2), a2 = new o2.prototype.Socket();
    return t2 = hr(function() {
      return a2.connect(s2), lr(dr(a2, "connect"));
    }, function() {
      var t3 = cr(e2, r2);
      return n2 = true, t3;
    }), i2 = function(t3) {
      if (n2) return t3;
      e2._attachSocket(a2), a2.emit("connect"), e2.Transport = o2, e2.Socket = o2.prototype.Socket, e2.Parser = o2.prototype.Parser;
    }, t2 && t2.then ? t2.then(i2) : i2(t2);
  });
  function lr(t2, e2) {
    if (!e2) return t2 && t2.then ? t2.then(ur) : Promise.resolve();
  }
  var fr = mr(function(t2) {
    return pr(ar(t2, { srv: [{ service: "xmpps-client", protocol: "tcp" }, { service: "xmpp-client", protocol: "tcp" }] }), function(t3) {
      return [].concat(new Set(t3.map(function(t4) {
        return t4.uri;
      })));
    });
  });
  function hr(t2, e2) {
    try {
      var r2 = t2();
    } catch (t3) {
      return e2(t3);
    }
    return r2 && r2.then ? r2.then(void 0, e2) : r2;
  }
  function pr(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  var dr = l.promise;
  function mr(r2) {
    return function() {
      for (var t2 = [], e2 = 0; e2 < arguments.length; e2++) t2[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t2));
      } catch (t3) {
        return Promise.reject(t3);
      }
    };
  }
  function vr(t2) {
    var n2 = t2.entity, e2 = n2.connect;
    n2.connect = function(t3) {
      try {
        return !t3 || /:\/\//.test(t3) ? pr(e2.call(this, t3)) : pr(fr(t3), function(t4) {
          e3 = n2;
          var e3, r2 = t4.filter(function(t5) {
            return e3._findTransport(t5);
          });
          if (0 === r2.length) throw new Error("No compatible transport found.");
          return hr(function() {
            return lr(cr(n2, r2));
          }, function(t5) {
            throw n2._reset(), n2._status("disconnect"), t5;
          });
        });
      } catch (t4) {
        return Promise.reject(t4);
      }
    };
  }
  var k = {};
  function yr(t2) {
    return (k = yr = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(t3) {
      return typeof t3;
    } : function(t3) {
      return t3 && "function" == typeof Symbol && t3.constructor === Symbol && t3 !== Symbol.prototype ? "symbol" : typeof t3;
    }).__esModule = true, k.default = k, yr(t2);
  }
  (k = yr).__esModule = true;
  var gr = {}, br = (k.default = k).default;
  (gr = function(t2, e2) {
    if ("object" != br(t2) || !t2) return t2;
    var r2 = t2[Symbol.toPrimitive];
    if (void 0 === r2) return ("string" === e2 ? String : Number)(t2);
    if (r2 = r2.call(t2, e2 || "default"), "object" != br(r2)) return r2;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }).__esModule = true, gr.default = gr;
  var wr = {}, _r = k.default;
  (wr = function(t2) {
    return t2 = gr(t2, "string"), "symbol" == _r(t2) ? t2 : t2 + "";
  }).__esModule = true, wr.default = wr;
  var xr = {};
  (xr = function(t2, e2, r2) {
    return (e2 = wr(e2)) in t2 ? Object.defineProperty(t2, e2, { value: r2, enumerable: true, configurable: true, writable: true }) : t2[e2] = r2, t2;
  }).__esModule = true, xr.default = xr;
  var _ = { encode: function(t2) {
    return globalThis.btoa(t2);
  }, decode: function(t2) {
    return globalThis.atob(t2);
  } }, Sr = t(r), Pr = ((o2) => {
    function t2() {
      for (var t3, e2 = arguments.length, r2 = new Array(e2), n2 = 0; n2 < e2; n2++) r2[n2] = arguments[n2];
      return (t3 = o2.call.apply(o2, [this].concat(r2)) || this).name = "SASLError", t3;
    }
    return (0, Sr.default)(t2, o2), t2;
  })(p);
  function jr(e2, t2) {
    var r2, n2 = Object.keys(e2);
    return Object.getOwnPropertySymbols && (r2 = Object.getOwnPropertySymbols(e2), t2 && (r2 = r2.filter(function(t3) {
      return Object.getOwnPropertyDescriptor(e2, t3).enumerable;
    })), n2.push.apply(n2, r2)), n2;
  }
  function Er() {
  }
  j = function(t2, e2, r2) {
    (e2.exports = r2).Factory = r2;
  }, "object" == typeof (M = { exports: {} }).exports && j(M.exports, M, F({}));
  var M = M.exports, Ar = Mr(function(t2, i2, e2, r2) {
    var s2, a2 = t2.create([e2]);
    if (a2) return t2 = i2.options.domain, s2 = function(e3) {
      for (var t3 = 1; t3 < arguments.length; t3++) {
        var r3 = null != arguments[t3] ? arguments[t3] : {};
        t3 % 2 ? jr(Object(r3), true).forEach(function(t4) {
          xr(e3, t4, r3[t4]);
        }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e3, Object.getOwnPropertyDescriptors(r3)) : jr(Object(r3)).forEach(function(t4) {
          Object.defineProperty(e3, t4, Object.getOwnPropertyDescriptor(r3, t4));
        });
      }
      return e3;
    }({ username: null, password: null, server: t2, host: t2, realm: t2, serviceType: "xmpp", serviceName: t2 }, r2), new Promise(function(r3, n2) {
      function o2(t3) {
        var e3;
        t3.attrs.xmlns === C && ("challenge" === t3.name ? (a2.challenge(kr(t3.text())), e3 = a2.response(s2), i2.send(b("response", { xmlns: C, mechanism: a2.name }, "string" == typeof e3 ? Lr(e3) : ""))) : ("failure" === t3.name ? n2(Pr.fromElement(t3)) : "success" === t3.name && r3(), i2.removeListener("nonza", o2)));
      }
      i2.on("nonza", o2), a2.clientFirst && i2.send(b("auth", { xmlns: C, mechanism: a2.name }, Lr(a2.response(s2))));
    });
    throw new Error("No compatible mechanism");
  });
  function Or(t2, e2) {
    if (!e2) return t2 && t2.then ? t2.then(Er) : Promise.resolve();
  }
  var Lr = _.encode, kr = _.decode;
  function Mr(r2) {
    return function() {
      for (var t2 = [], e2 = 0; e2 < arguments.length; e2++) t2[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t2));
      } catch (t3) {
        return Promise.reject(t3);
      }
    };
  }
  var C = "urn:ietf:params:xml:ns:xmpp-sasl";
  function Cr(t2, s2) {
    var t2 = t2.streamFeatures, a2 = new M();
    return t2.use("mechanisms", C, Mr(function(t3) {
      var e2, r2 = t3.stanza, n2 = t3.entity, o2 = (t3 = r2, t3.getChild("mechanisms", C).getChildElements().map(function(t4) {
        return t4.text();
      })), i2 = a2._mechs.map(function(t4) {
        return t4.name;
      }).filter(function(t4) {
        return o2.includes(t4);
      })[0];
      return t3 = function() {
        return Or(n2.restart());
      }, (e2 = (e2 = function() {
        return "function" == typeof s2 ? Or(s2(function(t4) {
          return Ar(a2, n2, i2, t4, r2);
        }, i2)) : (s2.username || s2.password || (i2 = "ANONYMOUS"), Or(Ar(a2, n2, i2, s2, r2)));
      })()) && e2.then ? e2.then(t3) : t3(e2);
    })), { use: function() {
      return a2.use.apply(a2, arguments);
    } };
  }
  function Tr(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  var Nr = Rr(function(e2, t2, r2) {
    return Tr(t2.set(b("bind", { xmlns: Xr }, (t2 = r2) && b("resource", {}, t2))), function(t3) {
      t3 = t3.getChildText("jid");
      return e2._jid(t3), t3;
    });
  });
  function Rr(r2) {
    return function() {
      for (var t2 = [], e2 = 0; e2 < arguments.length; e2++) t2[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t2));
      } catch (t3) {
        return Promise.reject(t3);
      }
    };
  }
  var Xr = "urn:ietf:params:xml:ns:xmpp-bind";
  function qr(t2, e2) {
    var n2, o2;
    t2.streamFeatures.use("bind", Xr, (n2 = e2, o2 = { iqCaller: t2.iqCaller }.iqCaller, Rr(function(t3, e3) {
      var r2 = t3.entity;
      return Tr("function" == typeof n2 ? n2(function(t4) {
        return Nr(r2, o2, t4);
      }) : Nr(r2, o2, n2), function() {
        e3();
      });
    })));
  }
  function Ir(t2) {
    var r2, i2 = t2.iqCaller;
    t2.streamFeatures.use("session", Fr, (r2 = function(t3, e2, r3) {
      return r3.getChild("optional") ? e2() : (r3 = i2.set(b("session", Fr)), n2 = function() {
        return e2();
      }, o2 ? n2 ? n2(r3) : r3 : (r3 && r3.then || (r3 = Promise.resolve(r3)), n2 ? r3.then(n2) : r3));
      var n2, o2;
    }, function() {
      for (var t3 = [], e2 = 0; e2 < arguments.length; e2++) t3[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t3));
      } catch (t4) {
        return Promise.reject(t4);
      }
    }));
  }
  var Fr = "urn:ietf:params:xml:ns:xmpp-session";
  function zr(t2, e2, r2) {
    return r2 ? e2 ? e2(t2) : t2 : (t2 && t2.then || (t2 = Promise.resolve(t2)), e2 ? t2.then(e2) : t2);
  }
  var Dr = Wr(function(t2, e2, r2) {
    return zr(t2.sendReceive(b("resume", { xmlns: T, h: e2, previd: r2 })), function(t3) {
      if (t3.is("resumed", T)) return t3;
      throw t3;
    });
  });
  function Br(t2, e2) {
    try {
      var r2 = t2();
    } catch (t3) {
      return e2(t3);
    }
    return r2 && r2.then ? r2.then(void 0, e2) : r2;
  }
  var Ur = Wr(function(o2, t2, e2) {
    return zr(o2.send(b("enable", { xmlns: T, max: e2, resume: t2 ? "true" : void 0 })), function() {
      return new Promise(function(r2, n2) {
        o2.on("nonza", function t3(e3) {
          if (e3.is("enabled", T)) r2(e3);
          else {
            if (!e3.is("failed", T)) return;
            n2(e3);
          }
          o2.removeListener("nonza", t3);
        });
      });
    });
  });
  var T = "urn:xmpp:sm:3";
  function Wr(r2) {
    return function() {
      for (var t2 = [], e2 = 0; e2 < arguments.length; e2++) t2[e2] = arguments[e2];
      try {
        return Promise.resolve(r2.apply(this, t2));
      } catch (t3) {
        return Promise.reject(t3);
      }
    };
  }
  function $r(t2) {
    var e2 = t2.streamFeatures, i2 = t2.entity, t2 = t2.middleware, s2 = null, a2 = { allowResume: true, preferredMaximum: null, enabled: false, id: "", outbound: 0, inbound: 0, max: null };
    return i2.on("online", function(t3) {
      s2 = t3, a2.outbound = 0, a2.inbound = 0;
    }), i2.on("offline", function() {
      a2.outbound = 0, a2.inbound = 0, a2.enabled = false, a2.id = "";
    }), t2.use(function(t3, e3) {
      t3 = t3.stanza;
      return ["presence", "message", "iq"].includes(t3.name) ? a2.inbound += 1 : t3.is("r", T) ? i2.send(b("a", { xmlns: T, h: a2.inbound })).catch(function() {
      }) : t3.is("a", T) && (a2.outbound = t3.attrs.h), e3();
    }), e2.use("sm", T, Wr(function(t3, n2) {
      var e3, r2, o2 = false;
      return r2 = function(t4) {
        if (o2) return t4;
        var t4 = n2, e4 = function() {
          var t5, e5, r4 = Ur(i2, a2.allowResume, a2.preferredMaximum);
          return a2.outbound = 0, t5 = Br(function() {
            return zr(r4, function(t6) {
              a2.enabled = true, a2.id = t6.attrs.id, a2.max = t6.attrs.max;
            });
          }, function() {
            a2.enabled = false;
          }), e5 = function() {
            a2.inbound = 0;
          }, t5 && t5.then ? t5.then(e5) : e5(t5);
        };
        if (void 0) return e4 ? e4(t4()) : t4();
        try {
          var r3 = Promise.resolve(t4());
          return e4 ? r3.then(e4) : r3;
        } catch (t5) {
          return Promise.reject(t5);
        }
      }, (e3 = (e3 = function() {
        if (a2.id) return Br(function() {
          return zr(Dr(i2, a2.inbound, a2.id), function() {
            return a2.enabled = true, i2.jid = s2, i2.status = "online", o2 = true;
          });
        }, function() {
          a2.id = "", a2.enabled = false, a2.outbound = 0;
        });
      })()) && e3.then ? e3.then(r2) : r2(e3);
    })), a2;
  }
  function Hr(t2) {
    t2.use(N);
  }
  function Kr(t2) {
    t2.use(R);
  }
  var N = { exports: {} }, R = (c = function(t2, e2, r2) {
    (e2.exports = r2).Mechanism = r2;
  }, "object" == typeof N.exports && c(N.exports, N, I({})), N = N.exports, { exports: {} }), r = (l = function(t2, e2, r2) {
    (e2.exports = r2).Mechanism = r2;
  }, "object" == typeof R.exports && l(R.exports, R, q({})), R = R.exports, {}), Yr = t(e), Jr = ["resource", "credentials", "username", "password"], p = E.jid, Gr = E.Client;
  return r.xml = E.xml, r.jid = p, r.client = function(t2) {
    var r2, e2, n2, o2, i2 = (t2 = t2 = void 0 === t2 ? {} : t2).resource, s2 = t2.credentials, a2 = t2.username, u2 = t2.password, c2 = (t2 = (0, Yr.default)(t2, Jr)).domain, l2 = t2.service;
    !c2 && l2 && (t2.domain = ((c2 = l2).split("://")[1] || c2).split(":")[0].split("/")[0]);
    var c2 = ((t3) => (t3 = t3.entity, (t3 = new de(t3)).start(), t3))({ entity: l2 = new Gr(t2) }), f2 = ({ entity: l2 }.entity.transports.push(ke), t2 = (t2 = { entity: l2 }).entity, f2 = Fe(r2 = t2, e2 = [function(t3, e3) {
      e3().then(function(t4) {
        return t4 && r2.send(t4);
      }).catch(function(t4) {
        return r2.emit("error", t4);
      });
    }], Xe), h2 = Fe(t2, n2 = [], Ie), t2.on("element", f2), t2.hookOutgoing = h2, { use: function(t3) {
      return e2.push(t3), t3;
    }, filter: function(t3) {
      return n2.push(t3), t3;
    } }), t2 = ze({ middleware: f2 }), h2 = function() {
      for (var t3, e3 = arguments.length, r3 = new Array(e3), n3 = 0; n3 < e3; n3++) r3[n3] = arguments[n3];
      return (t3 = (0, We.default)(Je, r3)).start(), t3;
    }({ middleware: f2, entity: l2 }), p2 = ((o2 = (p2 = { middleware: f2, entity: l2 }).middleware).use(er(p2.entity)), { get: function(t3, e3, r3) {
      o2.use(rr("get", t3, e3, r3));
    }, set: function(t3, e3, r3) {
      o2.use(rr("set", t3, e3, r3));
    } }), d2 = (vr({ entity: l2 }), Cr({ streamFeatures: t2 }, s2 || { username: a2, password: u2 })), s2 = $r({ streamFeatures: t2, entity: l2, middleware: f2 }), a2 = (qr({ iqCaller: h2, streamFeatures: t2 }, i2), Ir({ iqCaller: h2, streamFeatures: t2 }), Object.entries({ plain: Kr, anonymous: Hr }).map(function(t3) {
      var e3 = t3[0], t3 = t3[1], r3 = {};
      return r3[e3] = t3(d2), r3;
    }));
    return Object.assign(l2, { entity: l2, reconnect: c2, websocket: void 0, middleware: f2, streamFeatures: t2, iqCaller: h2, iqCallee: p2, resolve: void 0, sasl: d2, resourceBinding: void 0, sessionEstablishment: void 0, streamManagement: s2, mechanisms: a2 });
  }, r;
});
